# * [ PINOUT - M5Stack-Atom-matrix ](https://shop.m5stack.com/cdn/shop/products/7_0ba7f1df-51f7-41be-a0f6-a2bb946508c8_1200x1200.jpg)
#
# * [ PRODUCT - M5Stack-Atom-matrix ](https://shop.m5stack.com/products/atom-matrix-esp32-development-kit)
#
# * [ PINOUT - M5Stack-Atom-matrix ](https://shop.m5stack.com/cdn/shop/products/7_0ba7f1df-51f7-41be-a0f6-a2bb946508c8_1200x1200.jpg)

esphome:
  name: m5stack-atom
  friendly_name: M5Stack-Atom

esp32:
  board: esp32dev
  framework:
    type: arduino

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: !secret m5stack_atom_api_key
  # actions:
  #   - action: start_effect
  #     variables:
  #       my_brightness: int
  #       my_effect: string
  #     then:
  #       - light.turn_on:
  #           id: my_light
  #           brightness: !lambda 'return my_brightness;'
  #           effect: !lambda 'return my_effect;'

ota:
  - platform: esphome
    password: !secret esphome_ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  domain: !secret domain
  fast_connect: true
  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "M5Stack-Atom Fallback Hotspot"
    password: !secret wifi_password

# captive_portal:

web_server:
  port: 80

substitutions:
  lightEntity: lifx_nightvision_6d46f2_4

# Output that blinks the LED
output:
  - platform: template
    id: status_output
    type: binary
    write_action:
    - if:
        condition:
          lambda: return (state);
        then:
          - light.turn_on:
              id: led
              brightness: 70%
              red: 100%
              green: 0%
              blue: 0%
        else:
          - light.turn_off: led

#G12=IR
remote_transmitter:
  pin: GPIO12
  carrier_duty_percent: 50%

light:
  # Enable status LED
  - platform: status_led
    output: status_output
    name: "Status Led"
    internal: True

  #G27=RGB WS2812C-2020
  - platform: fastled_clockless
    chipset: WS2812
    pin: GPIO27
    num_leds: 25
    rgb_order: BRG
    name: "FastLED WS2812 Light"
    id: led
    
  # - platform: esp32_rmt_led_strip
  #   rgb_order: GRB
  #   pin: GPIO27
  #   num_leds: 25
  #   # RMT 0 channels will be occupied by IR
  #   rmt_channel: 1
  #   chipset: ws2812
  #   id: led
  #   name: "Led"

binary_sensor:
  #G39=Button
  - platform: gpio
    name: Button
    id: button_input_0
    pin:
      number: GPIO39
      inverted: true
    #   mode:
    #     input: true
    # filters:
    #   - delayed_off: 10ms
    on_press:
      then:
        - logger.log: Button G39 Pressed
        - homeassistant.action:
            action: script.button_light_toggle
            data:
              light_name: '$lightEntity'
            #   red: '255'
            #   green: '199'
            #   blue: '71'
        # - homeassistant.service:
        #     service: switch.toggle
        #     data:
        #       entity_id: light.$lightEntity

  - platform: homeassistant
    id: $lightEntity
    entity_id: light.$lightEntity
    internal: true
    on_state:
      then:
        - light.toggle: led
